<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="icon" href="/dendron-emi/favicon.ico"/><title>Backend</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="Personal Knowledge Space"/><meta property="og:title" content="Backend"/><meta property="og:description" content="Personal Knowledge Space"/><meta property="og:url" content="https://earth-metabolome-initiative.github.io/dendron-emi/notes/zurlb9xvgq0nac4vckzusam/"/><meta property="og:type" content="article"/><meta property="article:published_time" content="6/24/2024"/><meta property="article:modified_time" content="6/25/2024"/><link rel="canonical" href="https://earth-metabolome-initiative.github.io/dendron-emi/notes/zurlb9xvgq0nac4vckzusam/"/><meta name="next-head-count" content="14"/><link rel="preload" href="/dendron-emi/_next/static/css/5dce779fc0364c89.css" as="style"/><link rel="stylesheet" href="/dendron-emi/_next/static/css/5dce779fc0364c89.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/dendron-emi/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/dendron-emi/_next/static/chunks/webpack-3b2effb084faf656.js" defer=""></script><script src="/dendron-emi/_next/static/chunks/framework-28c999baf2863c3d.js" defer=""></script><script src="/dendron-emi/_next/static/chunks/main-14d1e5d58eb5de90.js" defer=""></script><script src="/dendron-emi/_next/static/chunks/pages/_app-04d7c1e3d3de408a.js" defer=""></script><script src="/dendron-emi/_next/static/chunks/935-4dee79e80b8641c6.js" defer=""></script><script src="/dendron-emi/_next/static/chunks/6-50972def09142ee2.js" defer=""></script><script src="/dendron-emi/_next/static/chunks/pages/notes/%5Bid%5D-78d472fa3b924116.js" defer=""></script><script src="/dendron-emi/_next/static/mg4gUYzPgp4Fi2pR6ElfI/_buildManifest.js" defer=""></script><script src="/dendron-emi/_next/static/mg4gUYzPgp4Fi2pR6ElfI/_ssgManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><section class="ant-layout" style="width:100%;min-height:100%"><header class="ant-layout-header" style="position:fixed;isolation:isolate;z-index:1;width:100%;border-bottom:1px solid #d4dadf;height:64px;padding:0 24px 0 2px"><div class="ant-row ant-row-center" style="max-width:992px;justify-content:space-between;margin:0 auto"><div style="display:flex" class="ant-col ant-col-xs-20 ant-col-sm-4"></div><div class="ant-col gutter-row ant-col-xs-0 ant-col-sm-20 ant-col-md-20 ant-col-lg-19"><div class="ant-select ant-select-lg ant-select-auto-complete ant-select-single ant-select-allow-clear ant-select-show-search" style="width:100%"><div class="ant-select-selector"><span class="ant-select-selection-search"><input type="search" autoComplete="off" class="ant-select-selection-search-input" role="combobox" aria-haspopup="listbox" aria-owns="undefined_list" aria-autocomplete="list" aria-controls="undefined_list" aria-activedescendant="undefined_list_0" value=""/></span><span class="ant-select-selection-placeholder">For full text search please use the &#x27;?&#x27; prefix. e.g. ? Onboarding</span></div></div></div><div style="display:none;align-items:center;justify-content:center" class="ant-col ant-col-xs-4 ant-col-sm-4 ant-col-md-0 ant-col-lg-0"><span role="img" aria-label="menu" style="font-size:24px" tabindex="-1" class="anticon anticon-menu"><svg viewBox="64 64 896 896" focusable="false" data-icon="menu" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg></span></div></div></header><section class="ant-layout" style="margin-top:64px;display:flex;flex-direction:row"><div class="site-layout-sidebar" style="flex:0 0 auto;width:calc(max((100% - 992px) / 2, 0px) + 200px);min-width:200px;padding-left:calc((100% - 992px) / 2)"><aside class="ant-layout-sider ant-layout-sider-dark" style="position:fixed;overflow:auto;height:calc(100vh - 64px);background-color:transparent;flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"></div></aside></div><main class="ant-layout-content side-layout-main" style="max-width:1200px;min-width:0;display:block"><div style="padding:0 24px"><div class="main-content" role="main"><div class="ant-row"><div class="ant-col ant-col-24"><div class="ant-row" style="margin-left:-10px;margin-right:-10px"><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-24 ant-col-md-18"><div><h1 id="backend">Backend<a aria-hidden="true" class="anchor-heading icon-link" href="#backend"></a></h1>
<h1 id="monorepo--backend">Monorepo : Backend<a aria-hidden="true" class="anchor-heading icon-link" href="#monorepo--backend"></a></h1>
<p>Here we describe the basic structure of the backend of the <a href="https://github.com/earth-metabolome-initiative/emi-monorepo/tree/web">EMI monorepo</a>.</p>
<h2 id="constraint_checkers"><code>constraint_checkers</code><a aria-hidden="true" class="anchor-heading icon-link" href="#constraint_checkers"></a></h2>
<p>This folder contains the metaprogramming code to check the correctness of the database, and then to generate the rust files depending on the constraints.</p>
<h2 id="db_data"><code>db_data</code><a aria-hidden="true" class="anchor-heading icon-link" href="#db_data"></a></h2>
<p>Folder containing csv files with the data that will be inserted into the database. For example, the file <code>countries.csv</code> contains the list of all available/allowed countries in the database.</p>
<h2 id="migrations"><code>migrations</code><a aria-hidden="true" class="anchor-heading icon-link" href="#migrations"></a></h2>
<p>Folder containing the SQL files that are used to create the database schema. The files are numbered in order of execution.
Here is a brief description of the types of tables:</p>
<ul>
<li><code>create_*_table</code> creates a table in the database</li>
<li><code>create_*_sequential_index</code> changes the <code>id</code> column of the table from INTEGER to SERIAL</li>
<li><code>populate_*_table</code> populates the table with data from the csv files in the <code>db_data</code> folder</li>
<li><code>create_*_gin_index</code> creates an index to allow for searching in the table</li>
<li><code>create_*_can_x_trigger</code> contain a function that takes a user ID (INTEGER) and the primary keys and returns a BOOLEAN indicating whether the user can {operation} the row</li>
</ul>
<h2 id="src"><code>src</code><a aria-hidden="true" class="anchor-heading icon-link" href="#src"></a></h2>
<h3 id="api"><code>api</code><a aria-hidden="true" class="anchor-heading icon-link" href="#api"></a></h3>
<h4 id="oauth"><code>oauth</code><a aria-hidden="true" class="anchor-heading icon-link" href="#oauth"></a></h4>
<p>Directory containing the code for the OAuth2.0 authentication and its dependencies (login/logout, login providers, refresh tokens, etc).  </p>
<h4 id="ws"><code>ws</code><a aria-hidden="true" class="anchor-heading icon-link" href="#ws"></a></h4>
<p>Directory containing the code for the websockets.</p>
<h3 id="database"><code>database</code><a aria-hidden="true" class="anchor-heading icon-link" href="#database"></a></h3>
<p>This directory contains the code for the database connection between the backend and the database. We are using the <a href="https://diesel.rs/">Diesel</a> crate to interact with the database. Most of the code in this directory is generated automatically by the <code>constraint_checkers</code> package.</p></div></div><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-0 ant-col-md-6"><div><div class=""><div class="ant-anchor-wrapper dendron-toc" style="max-height:calc(100vh - 64px);z-index:1"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#monorepo--backend" title="Monorepo : Backend">Monorepo : Backend</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#constraint_checkers" title="constraint_checkers">constraint_checkers</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#db_data" title="db_data">db_data</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#migrations" title="migrations">migrations</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#src" title="src">src</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#api" title="api">api</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#oauth" title="oauth">oauth</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#ws" title="ws">ws</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#database" title="database">database</a></div></div></div></div></div></div></div></div></div></div></div><div class="ant-divider ant-divider-horizontal" role="separator"></div><footer class="ant-layout-footer" style="padding:0 24px 24px"></footer></main></section></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"note":{"id":"zurlb9xvgq0nac4vckzusam","title":"Backend","desc":"","updated":1719306973256,"created":1719241390631,"custom":{},"fname":"monorepo.Backend","type":"note","vault":{"fsPath":".","selfContained":true,"name":"dendron-emi"},"contentHash":"623debfc17121eb6d2734ea683253c7b","links":[],"anchors":{"monorepo--backend":{"type":"header","text":"Monorepo : Backend","value":"monorepo--backend","line":8,"column":0,"depth":1},"constraint_checkers":{"type":"header","text":"constraint_checkers","value":"constraint_checkers","line":11,"column":0,"depth":2},"db_data":{"type":"header","text":"db_data","value":"db_data","line":14,"column":0,"depth":2},"migrations":{"type":"header","text":"migrations","value":"migrations","line":17,"column":0,"depth":2},"src":{"type":"header","text":"src","value":"src","line":26,"column":0,"depth":2},"api":{"type":"header","text":"api","value":"api","line":27,"column":0,"depth":3},"oauth":{"type":"header","text":"oauth","value":"oauth","line":28,"column":0,"depth":4},"ws":{"type":"header","text":"ws","value":"ws","line":31,"column":0,"depth":4},"database":{"type":"header","text":"database","value":"database","line":34,"column":0,"depth":3}},"children":[],"parent":"smclm9qks60i3brdytv436w","data":{}},"body":"\u003ch1 id=\"backend\"\u003eBackend\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#backend\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003ch1 id=\"monorepo--backend\"\u003eMonorepo : Backend\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#monorepo--backend\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cp\u003eHere we describe the basic structure of the backend of the \u003ca href=\"https://github.com/earth-metabolome-initiative/emi-monorepo/tree/web\"\u003eEMI monorepo\u003c/a\u003e.\u003c/p\u003e\n\u003ch2 id=\"constraint_checkers\"\u003e\u003ccode\u003econstraint_checkers\u003c/code\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#constraint_checkers\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eThis folder contains the metaprogramming code to check the correctness of the database, and then to generate the rust files depending on the constraints.\u003c/p\u003e\n\u003ch2 id=\"db_data\"\u003e\u003ccode\u003edb_data\u003c/code\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#db_data\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eFolder containing csv files with the data that will be inserted into the database. For example, the file \u003ccode\u003ecountries.csv\u003c/code\u003e contains the list of all available/allowed countries in the database.\u003c/p\u003e\n\u003ch2 id=\"migrations\"\u003e\u003ccode\u003emigrations\u003c/code\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#migrations\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eFolder containing the SQL files that are used to create the database schema. The files are numbered in order of execution.\nHere is a brief description of the types of tables:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003ecreate_*_table\u003c/code\u003e creates a table in the database\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ecreate_*_sequential_index\u003c/code\u003e changes the \u003ccode\u003eid\u003c/code\u003e column of the table from INTEGER to SERIAL\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003epopulate_*_table\u003c/code\u003e populates the table with data from the csv files in the \u003ccode\u003edb_data\u003c/code\u003e folder\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ecreate_*_gin_index\u003c/code\u003e creates an index to allow for searching in the table\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ecreate_*_can_x_trigger\u003c/code\u003e contain a function that takes a user ID (INTEGER) and the primary keys and returns a BOOLEAN indicating whether the user can {operation} the row\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"src\"\u003e\u003ccode\u003esrc\u003c/code\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#src\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003ch3 id=\"api\"\u003e\u003ccode\u003eapi\u003c/code\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#api\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003ch4 id=\"oauth\"\u003e\u003ccode\u003eoauth\u003c/code\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#oauth\"\u003e\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003eDirectory containing the code for the OAuth2.0 authentication and its dependencies (login/logout, login providers, refresh tokens, etc).  \u003c/p\u003e\n\u003ch4 id=\"ws\"\u003e\u003ccode\u003ews\u003c/code\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#ws\"\u003e\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003eDirectory containing the code for the websockets.\u003c/p\u003e\n\u003ch3 id=\"database\"\u003e\u003ccode\u003edatabase\u003c/code\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#database\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eThis directory contains the code for the database connection between the backend and the database. We are using the \u003ca href=\"https://diesel.rs/\"\u003eDiesel\u003c/a\u003e crate to interact with the database. Most of the code in this directory is generated automatically by the \u003ccode\u003econstraint_checkers\u003c/code\u003e package.\u003c/p\u003e","noteIndex":{"id":"3rbfqqbp7pwbkdcrgc97u7l","title":"The Earth Metabolome Initiative","desc":"","updated":1671988421333,"created":1671985562294,"custom":{"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":".","selfContained":true,"name":"dendron-emi"},"contentHash":"4a9583a0623e72b112fd491979429bc1","links":[{"type":"wiki","from":{"fname":"root","id":"3rbfqqbp7pwbkdcrgc97u7l","vaultName":"dendron-emi"},"value":"dendron","position":{"start":{"line":4,"column":69,"offset":257},"end":{"line":4,"column":83,"offset":271},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"dendron"}}],"anchors":{"welcome-to-the-earth-metabolome-initiative-dendron-notes":{"type":"header","text":"Welcome to the Earth Metabolome Initiative Dendron notes","value":"welcome-to-the-earth-metabolome-initiative-dendron-notes","line":7,"column":0,"depth":1},"what-is-the-earth-metabolome-initiative-":{"type":"header","text":"What is the Earth Metabolome Initiative ?","value":"what-is-the-earth-metabolome-initiative-","line":12,"column":0,"depth":1},"how-is-it-related-to-the-digital-botanical-gardens-initiative-":{"type":"header","text":"How is it related to the Digital Botanical Gardens Initiative ?","value":"how-is-it-related-to-the-digital-botanical-gardens-initiative-","line":19,"column":0,"depth":1},"an-open-science-project":{"type":"header","text":"An Open Science project","value":"an-open-science-project","line":24,"column":0,"depth":1},"working-with-the-garage-door-up":{"type":"header","text":"Working with the garage door up","value":"working-with-the-garage-door-up","line":26,"column":0,"depth":2},"open-notebook-science":{"type":"header","text":"Open Notebook Science","value":"open-notebook-science","line":32,"column":0,"depth":2}},"children":["vrae5dt51ddpchgp8ny78cp","l03fwlci5f5rdpot3v7oli6","ifd39krpwjbpoujotes8k8e","4ukw0m9fnolvo16alfg228n","s1ylfmp2pclqnwyr7c4kf7i","gug1zw6wdzvta1evuzc5nut","gz9usdkc2az543npdnopxrs","fzeg276w1meifz5qyccsd4s","yvialv0y265tyn1u4xxygn6","smclm9qks60i3brdytv436w","em044ww0x12gvshkq9s1gp6","3yuaegcggymmvr8og84zkur","cg7slewy3y8h81yvqfao1xt"],"parent":null,"data":{},"body":"# Welcome to the Earth Metabolome Initiative Dendron notes\n\nDendron is the knowledge management system we use in the EMI. We use it specifically to manage notes, lab-books and share ideas.\nIf you want to know more about Dendron, have a look at this section [[dendron.md]].\n\n# What is the Earth Metabolome Initiative ?\n\n\n![](/assets/images/EMI_logo_round.png){max-width: 300px, display: block, margin: 0 auto}\n\nThe Earth Metabolome Initiative, abbreviated EMI, is an Open Science initiative and a global effort to profile the metabolic content of all currently known species on our planet (~2.3 million species). We are building the required computational, scientific and organizational architecture to establish the network of ressources and humans to advance in this massive undertaking. The EMI will explore the chemical foundations of Life for a better human society within a thriving biosphere.\n\n# How is it related to the Digital Botanical Gardens Initiative ?\n\nWe have started the Digital Botanical Gardens Initiative, abbreviated DBGI, as a pilot project for the EMI. You can find more details about the DBGI at \u003chttps://www.dbgi.org/dendron-dbgi\u003e.\n\n\n# An Open Science project\n\n## Working with the garage door up\n\nA way of working briefly described by Andy Matuschak here https://notes.andymatuschak.org/z21cgR9K3UcQ5a7yPsj2RUim3oM2TzdBByZu.\n\n![](/assets/images/2022-12-25-18-13-17.png){max-width: 400px}\n\n## Open Notebook Science\n\nIf we apply this \"working with the garage door up\" idea to a scientific research endeavor, we understand it as respecting the core concepts of open-science. These are in fact the principles of Open Notebook Science https://en.wikipedia.org/wiki/Open-notebook_science.\n\nFor the projects of the DBGI, we will follow this approach in order to share early ideas and results but also the less shiny parts of the research projects. \nExpect to find strange ideas, badly formulated text and poorly written code. However if you have time and interest, you should be able to participate at each step of the process. Hopefully, this will lead to enhanced collaboration and participation. Maybe yes, maybe not. Let's make it a methodological experiment!\n\nThe pages of this website are written in Markdown and hosted on Github. You can edit them by clicking on the \"Click here to edit this page on Github !\" link at the bottom of the page\n"},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true,"enableSelfContainedVaults":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":true,"vaultSelectionModeOnCreate":"smart","leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2}},"randomNote":{},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"copyNoteLink":{"aliasMode":"title"},"templateHierarchy":"template"},"workspace":{"vaults":[{"fsPath":".","selfContained":true,"name":"dendron-emi"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"task":{"name":"task","dateFormat":"y.MM.dd","addBehavior":"asOwnDomain","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"taskCompleteStatus":["done","x"],"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link"},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"enableUserTags":true,"enableHashTags":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":false,"enableEditorDecorations":true,"maxPreviewsCached":10,"maxNoteLength":204800,"enableFullHierarchyNoteTitle":false},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false},"publishing":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"copyAssets":true,"siteHierarchies":["root"],"writeStubs":false,"siteRootDir":"docs","seo":{"title":"Dendron","description":"Personal Knowledge Space"},"github":{"enableEditLink":true,"editLinkText":"Feel free to participate and click here to edit this page on Github !","editBranch":"main","editViewMode":"tree","editRepository":"https://github.com/earth-metabolome-initiative/dendron-emi"},"enableSiteLastModified":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"enableTaskNotes":true,"enablePrettyLinks":true,"searchMode":"search","siteUrl":"https://earth-metabolome-initiative.github.io","assetsPrefix":"/dendron-emi","siteFaviconPath":"favicon.ico","siteIndex":"root"}}},"__N_SSG":true},"page":"/notes/[id]","query":{"id":"zurlb9xvgq0nac4vckzusam"},"buildId":"mg4gUYzPgp4Fi2pR6ElfI","assetPrefix":"/dendron-emi","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>